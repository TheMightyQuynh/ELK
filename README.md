# Setting up Elasticsearch on AWS Free Tier

This example is based off A Cloud Guru's <a href="https://learn.acloud.guru/course/1e3ff00e-95bf-451b-be04-44d4bce6bfba/dashboard">Elastic Search Deep Dive</a> course. In the course he is using CentOS 7 servers on the cloud playground, here I am using Ubuntu 22.04 on AWS which has a few key differences.

## Prerequisites
1. 3 EC2 instances
   - Application and OS Images: Ubuntu Server 22.04 LTS (HVM), SSD Volume Type (Free tier eligible)
   - Instance type: t2.micro (Free tier eligible)
   - Key pair (login) - only needs to be done once, not for each instance:
     - Key pair type: RSA
     - Private key file format: .pem
   - Network settings: Create security group with default settings if one doesn't already exist, otherwise select an existing security group
   - The rest can be default
   - Optional: Add a tag for each instance with Key "Node Name" and Value of "master-1", "data-1", and "data-2" to easily identify which instance is which node
2. Connect to each instance using an SSH client, e.g. PuTTy for this example
   - Use PuTTyGen to load the .pem file created in prerequisite step 1 and save the generated key as a private key (.ppk)
   - Open PuTTy and enter the public IPv4 address of the EC2 instance in Host Name
   - Under Category, go to Connection > SSH > Auth and under Authentication parameters, click Browse and load the .ppk file generated by PuTTyGen
   - Click Open to connect
   - Login as `ubuntu`

Once you are able to connect to all three instances, you can install Elasticsearch on them.

## Install Elasticsearch
Elasticsearch requires OpenJDK 11 to run. Note: These steps differ from the course!

1. Install Java
```
sudo apt install openjdk-11-jdk
```
4. Install the API for downloading via HTTPS and import the GPG key for Elasticsearch packages
```
sudo apt install apt-transport-https 
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
```
5. Configure the apt repository to install latest Elasticsearch 6.X
```
sudo add-apt-repository "deb https://artifacts.elastic.co/packages/6.x/apt stable main"
```
6. Update the package list and install Elasticsearch
```
sudo apt update 
sudo apt install elasticsearch 
```

The above steps should be done for all three EC2 instances.

## Configure Elasticsearch
Note: Some of the configuration settings are different from those shown in the course (Elasticsearch 6.x vs 7.x). 

1. Edit the configuration file in the editor of your choice.
```
sudo nano /etc/elasticsearch/elasticsearch.yml 
```
2. Uncomment and update the following configurations (following the example in the course with some key differences as noted):
   - cluster.name: playground
   - node.name: master-1
   - network.host: [\_local\_, \_site\_]
   - discovery.zen.ping.unicast.hosts: ["`private IP of your EC2 instance hosting the master-1 node`"]
     - Note: This configuration is in place of discovery.seed_hosts
   - discovery.zen.minimum_master_nodes: 1
     - Note: This configuration is in place of cluster.initial_master_nodes

